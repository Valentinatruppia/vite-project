<!DOCTYPE html>
<html lang="it">
    <head>
        <title>STATISTICS</title>
        <h1>STATISTICS</h1>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <style>
        body {
                overflow-y: scroll; /* Enable vertical scrolling for the entire page */
                margin: 0; /* Remove default margin to avoid unnecessary space */
            }

            .charts-container {
                display: flex;
                margin: 20px;
            }

            canvas {
                border: 1px solid #000000;
                margin-bottom: 20px; /* Add some space between charts */
            }
        </style>
    </head>
    <body>
        <a>
            <button type="button">maschi e femmine</button>
            <button type="button">................</button>
            <button type="button">----------------</button>
            <button type="button">''''''''''''''''</button>
            <button type="button">,,,,,,,,,,,,,,,,</button>
        </a>

        <div class="charts-container">
            <canvas id="myChart" width="800" height="500"></canvas>
            <canvas id="myChartPast" width="800" height="500"></canvas>
        </div>
        <script>
        let array = [0];
        let arraypast = [0];
        fetchDati(), fetchDatiPast();
        let y = [];
        let yPast = [];



        async function fetchDati() {

            try {
                // Effettua la richiesta fetch e attendi la risposta
                const response = await fetch("https://raw.githubusercontent.com/Valentinatruppia/vite-project/main/incidenti.json");
                if (!response.ok) {
                throw new Error(`Errore HTTP: ${response.status}`);
                }
                const data = await response.json();
                data.forEach((element)=> {
                    array.push(element)
                });//popola l'array locale
                const Maschi=array.filter(s => s["Sesso"]==="M" && s["TipoPersona"]==="Conducente");
                const Femmine=array.filter(s => s["Sesso"]==="F" && s["TipoPersona"]==="Conducente");
                y = [Maschi.length,Femmine.length];
                PlotIstogramma();
                /*
                console.log("array completo: ",array);
                const anno=array.filter(a => a["Anno"]===2019);
                console.log("filtro con anno 2019: ",anno);
                const giorno=array.filter(g => g["Giorno"]==="Lunedi");
                console.log("filtro con giorno lunedi: ",giorno);
                const totale1=array.reduce((accumulatore, smc)=> accumulatore+smc["Totale (Smc)"],1);
                console.log("reduce smc: ",totale1);
                const smc=array.filter(smc => smc["Totale (Smc)"]>6641610);
                console.log("filtro con smc>6641610: ",smc);
                */
            } catch (error) {
                console.error(`Impossibile recuperare i dati: ${error}`);
            }
        }

        async function fetchDatiPast() {

            try {
                // Effettua la richiesta fetch e attendi la risposta
                const response = await fetch("https://raw.githubusercontent.com/Valentinatruppia/vite-project/main/incidentipast.json");
                if (!response.ok) {
                throw new Error(`Errore HTTP: ${response.status}`);
                }
                const data = await response.json();
                data.forEach((element)=> {
                    arraypast.push(element)
                });//popola l'array locale
                const MaschiPast=arraypast.filter(s => s["Sesso"]==="M" && s["TipoPersona"]==="Conducente");
                const FemminePast=arraypast.filter(s => s["Sesso"]==="F" && s["TipoPersona"]==="Conducente");
                yPast = [MaschiPast.length,FemminePast.length];
                PlotIstogrammaPast();
            /*
                console.log("array completo: ",array);
                const anno=array.filter(a => a["Anno"]===2019);
                console.log("filtro con anno 2019: ",anno);
                const giorno=array.filter(g => g["Giorno"]==="Lunedi");
                console.log("filtro con giorno lunedi: ",giorno);
                const totale1=array.reduce((accumulatore, smc)=> accumulatore+smc["Totale (Smc)"],1);
                console.log("reduce smc: ",totale1);
                const smc=array.filter(smc => smc["Totale (Smc)"]>6641610);
                console.log("filtro con smc>6641610: ",smc);
            */
            } catch (error) {
                console.error(`Impossibile recuperare i dati: ${error}`);
            }
        }


        function PlotIstogramma() {

            new Chart("myChart", {
                type: "pie",
                data: {
                    labels: ["Maschi","Femmine"],
                    datasets: [{
                        label: "Numero incidenti",
                        backgroundColor: [
                        'rgb(54, 162, 235)',
                        'rgb(255, 99, 132)'],
                        data: y
                    }]
                },
                options: {
                    plugins: {
                        title: {
                            display: true,
                            text: 'Distribution of Incidents by Gender(2022)'
                        }
                    },
                responsive:false
            }
            });
        }
        function PlotIstogrammaPast() {

            new Chart("myChartPast", {
                type: "pie",
                data: {
                    labels: ["Maschi","Femmine"],
                    datasets: [{
                        label: "Numero incidenti",
                        backgroundColor: [
                        'rgb(54, 162, 235)',
                        'rgb(255, 99, 132)'],
                        data: yPast
                    }]
                },
                options: {
                    plugins: {
                        title: {
                            display: true,
                            text: 'Distribution of Incidents by Gender(2008)'
                        }
                    },
                responsive:false
                }
            });
        }
        </script>
    </body>
</html>